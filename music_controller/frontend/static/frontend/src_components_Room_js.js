/*! For license information please see src_components_Room_js.js.LICENSE.txt */
"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([["src_components_Room_js"],{"./src/components/ChatRoom.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/Box/Box.js");\n/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/Typography/Typography.js");\n/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/TextField/TextField.js");\n/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/Button/Button.js");\n/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/List/List.js");\n/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/ListItem/ListItem.js");\n\n\nconst ChatRoom = ({\n  roomCode\n}) => {\n  const [messages, setMessages] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]);\n  const [message, setMessage] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)("");\n  const [username, setUsername] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(""); // Ensure username starts as an empty string\n  const [isNameSet, setIsNameSet] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false); // Track if username is set\n\n  // Fetch messages every 2 seconds\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    const fetchMessages = async () => {\n      const response = await fetch(`/api/chat/${roomCode}/receive/`);\n      const data = await response.json();\n      setMessages(data);\n    };\n    fetchMessages();\n    const intervalId = setInterval(fetchMessages, 2000); // Poll every 2 seconds\n\n    return () => clearInterval(intervalId); // Cleanup interval on unmount\n  }, [roomCode]);\n  const handleSendMessage = async () => {\n    if (!username) {\n      alert("Please enter your username before sending a message.");\n      return;\n    }\n    const requestBody = {\n      room_code: roomCode,\n      user: username,\n      message: message\n    };\n    const response = await fetch(`/api/chat/${roomCode}/send/`, {\n      method: "POST",\n      headers: {\n        "Content-Type": "application/json"\n      },\n      body: JSON.stringify(requestBody)\n    });\n    if (response.ok) {\n      setMessage(""); // Clear message input after sending\n    } else {\n      console.error("Error sending message");\n    }\n  };\n  const handleSetUsername = () => {\n    if (username.trim()) {\n      setIsNameSet(true); // Set the name if it is not empty\n    } else {\n      alert("Please provide a valid name.");\n    }\n  };\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_1__["default"], null, !isNameSet ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_1__["default"], {\n    display: "flex",\n    flexDirection: "column",\n    alignItems: "center"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_2__["default"], {\n    variant: "h6"\n  }, "Enter Your Name"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_3__["default"], {\n    label: "Username",\n    value: username,\n    onChange: e => setUsername(e.target.value),\n    fullWidth: true,\n    sx: {\n      maxWidth: "300px",\n      marginBottom: 2\n    }\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_4__["default"], {\n    variant: "contained",\n    color: "primary",\n    onClick: handleSetUsername,\n    sx: {\n      width: "200px"\n    }\n  }, "Set Username")) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_2__["default"], {\n    variant: "h6",\n    gutterBottom: true,\n    sx: {\n      fontWeight: \'bold\',\n      textAlign: \'center\'\n    }\n  }, "Chat"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_1__["default"], {\n    sx: {\n      height: "300px",\n      // Set the height of the chat box\n      overflow: "auto",\n      // Allow scrolling\n      border: "1px solid #ccc",\n      // Border around the messages box\n      padding: "10px",\n      // Padding around the messages\n      marginBottom: "10px"\n    }\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_5__["default"], null, messages.map((msg, index) => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_6__["default"], {\n    key: index,\n    sx: {\n      display: \'flex\',\n      justifyContent: \'space-between\',\n      paddingLeft: 0\n    }\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_1__["default"], {\n    sx: {\n      display: \'flex\',\n      flexDirection: \'column\',\n      alignItems: \'flex-start\'\n    }\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("strong", null, msg.user, ": "), " ", msg.message), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_1__["default"], {\n    sx: {\n      alignSelf: \'flex-start\',\n      fontSize: \'0.8rem\',\n      color: \'gray\'\n    }\n  }, new Date(msg.timestamp).toLocaleTimeString(), " "))))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_3__["default"], {\n    label: "Type a message",\n    value: message,\n    onChange: e => setMessage(e.target.value),\n    fullWidth: true,\n    sx: {\n      marginBottom: 2\n    },\n    inputProps: {\n      maxLength: 200 // Limit input to 200 characters\n    }\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_2__["default"], {\n    variant: "body2",\n    color: "textSecondary",\n    align: "right"\n  }, message.length, "/200 characters"), " ", /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_4__["default"], {\n    variant: "contained",\n    color: "primary",\n    onClick: handleSendMessage,\n    sx: {\n      width: "200px"\n    }\n  }, "Send")));\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (ChatRoom);\n\n//# sourceURL=webpack://frontend/./src/components/ChatRoom.js?')},"./src/components/Room.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ "./node_modules/react/index.js");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var react_router_dom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! react-router-dom */ "./node_modules/react-router/dist/development/chunk-SYFQ2XB5.mjs");\n/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/Box/Box.js");\n/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/Button/Button.js");\n/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/Typography/Typography.js");\n/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/Card/Card.js");\n/* harmony import */ var _mui_material__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @mui/material */ "./node_modules/@mui/material/CardContent/CardContent.js");\n/* harmony import */ var _ChatRoom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ChatRoom */ "./src/components/ChatRoom.js");\n\n\n\n\n\n// Lazy load the MusicPlayer component\nconst MusicPlayer = /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().lazy(() => Promise.all(/*! import() */[__webpack_require__.e("vendors-node_modules_mui_material_IconButton_IconButton_js"), __webpack_require__.e("vendors-node_modules_mui_material_Alert_Alert_js"), __webpack_require__.e("vendors-node_modules_mui_icons-material_esm_Pause_js-node_modules_mui_icons-material_esm_Play-ae5f25"), __webpack_require__.e("src_components_MusicPlayer_js")]).then(__webpack_require__.bind(__webpack_require__, /*! ./MusicPlayer */ "./src/components/MusicPlayer.js")));\nconst CreateRoomPage = /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().lazy(() => Promise.all(/*! import() */[__webpack_require__.e("vendors-node_modules_mui_material_IconButton_IconButton_js"), __webpack_require__.e("vendors-node_modules_mui_material_Alert_Alert_js"), __webpack_require__.e("vendors-node_modules_mui_material_Collapse_Collapse_js-node_modules_mui_material_FormControlL-80df81"), __webpack_require__.e("src_components_CreateRoomPage_js-_fa701")]).then(__webpack_require__.bind(__webpack_require__, /*! ./CreateRoomPage */ "./src/components/CreateRoomPage.js")));\nconst Room = ({\n  leaveRoomCallback,\n  username\n}) => {\n  const {\n    roomCode\n  } = (0,react_router_dom__WEBPACK_IMPORTED_MODULE_2__.useParams)();\n  const navigate = (0,react_router_dom__WEBPACK_IMPORTED_MODULE_2__.useNavigate)();\n  const [votesToSkip, setVotesToSkip] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(2);\n  const [guestCanPause, setGuestCanPause] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);\n  const [isHost, setIsHost] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);\n  const [showSettings, setShowSettings] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);\n  const [spotifyAuthenticated, setSpotifyAuthenticated] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);\n  const [song, setSong] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)({});\n\n  // Fetch room details\n  const getRoomDetails = async () => {\n    try {\n      const response = await fetch(`/api/get-room?code=${roomCode}`);\n      if (!response.ok) {\n        leaveRoomCallback();\n        navigate("/");\n        return;\n      }\n      const data = await response.json();\n      setVotesToSkip(data.votes_to_skip);\n      setGuestCanPause(data.guest_can_pause);\n      setIsHost(data.is_host);\n      if (data.is_host) {\n        authenticateSpotify();\n      }\n    } catch (error) {\n      console.error("Failed to fetch room details:", error);\n    }\n  };\n\n  // Spotify authentication\n  const authenticateSpotify = async () => {\n    try {\n      const response = await fetch("/spotify/is-authenticated");\n      const data = await response.json();\n      setSpotifyAuthenticated(data.status);\n      if (!data.status) {\n        const authResponse = await fetch("/spotify/get-auth-url");\n        const authData = await authResponse.json();\n        window.location.replace(authData.url);\n      }\n    } catch (error) {\n      console.error("Spotify authentication failed:", error);\n    }\n  };\n\n  // Fetch current song\n  const getCurrentSong = async () => {\n    try {\n      const response = await fetch("/spotify/current-song");\n      if (response.status === 204) {\n        console.log("No song is currently playing.");\n        return; // Exit early if no content is returned\n      }\n      if (response.status === 401) {\n        console.error("User is not authenticated. Redirecting to Spotify login.");\n        // Redirect user to Spotify authentication if needed\n        window.location.href = "/spotify/get-auth-url";\n        return;\n      }\n      if (!response.ok) {\n        throw new Error(`API Error: ${response.status} - ${response.statusText}`);\n      }\n      const data = await response.json();\n      setSong(data);\n      console.log("Current song data:", data);\n    } catch (error) {\n      console.error("Failed to fetch current song:", error);\n    }\n  };\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    getRoomDetails();\n    const songInterval = setInterval(getCurrentSong, 1000);\n    return () => clearInterval(songInterval); // Cleanup interval on component unmount\n  }, [roomCode, navigate, leaveRoomCallback]);\n\n  // Leave room\n  const leaveButtonPressed = async () => {\n    try {\n      await fetch("/api/leave-room", {\n        method: "POST",\n        headers: {\n          "Content-Type": "application/json"\n        }\n      });\n      leaveRoomCallback();\n      navigate("/");\n    } catch (error) {\n      console.error("Error leaving room:", error);\n    }\n  };\n\n  // Render settings\n  const renderSettings = () => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_3__["default"], {\n    display: "flex",\n    flexDirection: "column",\n    alignItems: "center",\n    padding: 3\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(CreateRoomPage, {\n    update: true,\n    votesToSkip: votesToSkip,\n    guestCanPause: guestCanPause,\n    roomCode: roomCode,\n    updateCallback: getRoomDetails\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_4__["default"], {\n    variant: "contained",\n    color: "secondary",\n    sx: {\n      marginTop: 2\n    },\n    onClick: () => setShowSettings(false)\n  }, "Close"));\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_3__["default"], {\n    display: "flex",\n    flexDirection: "column",\n    alignItems: "center",\n    padding: 3\n  }, showSettings ? renderSettings() : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_5__["default"], {\n    variant: "h4",\n    gutterBottom: true\n  }, "Room Code: ", roomCode), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(react__WEBPACK_IMPORTED_MODULE_0__.Suspense, {\n    fallback: /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement("div", null, "Loading Music Player...")\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(MusicPlayer, song)), isHost && /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_4__["default"], {\n    variant: "contained",\n    color: "primary",\n    onClick: () => setShowSettings(true),\n    sx: {\n      marginTop: 2\n    }\n  }, "Settings"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_4__["default"], {\n    variant: "contained",\n    color: "secondary",\n    onClick: leaveButtonPressed,\n    sx: {\n      marginTop: 2\n    }\n  }, "Leave Room"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_6__["default"], {\n    sx: {\n      marginTop: 3,\n      width: \'100%\',\n      maxWidth: 500,\n      padding: 2\n    }\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_mui_material__WEBPACK_IMPORTED_MODULE_7__["default"], null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(_ChatRoom__WEBPACK_IMPORTED_MODULE_1__["default"], {\n    roomCode: roomCode,\n    username: username\n  })))));\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Room);\n\n//# sourceURL=webpack://frontend/./src/components/Room.js?')}}]);